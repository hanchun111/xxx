/**
 * * Auto generated by Bossssoft Studio version 1.0 beta Sun Sep 18 11:47:10 CST
 * 2016
 */
// define(['引入外部js模块或控件'],function('引入外部js或控件的别名'){})
define(
		[ "app/widgets/window/app-dialog", "app/app-pagebase" ],
		function(Dialog, PageBase) {
			var AfaUserDlg = PageBase.extend({
						// 类初始化
						initialize : function() {
							AfaUserDlg.superclass.initialize.call(this);
						},
						ACTION : {
							ADD : "ADD",
							EDIT : "EDIT",
							VIEW : "VIEW"
						},
						orgMsg:null,
						// 存储弹出窗口回调
						showPageCallBack : null,
						// 当前窗口状态
						indexAction : null,
						// 控件监听事件 格式：#控件id#:{事件名:事件方法}
						listeners : {
							// 新增并保存

							afaUserPage_saveaddBtn : {
								click : function() {
									var self = AfaUserDlg.getInstance();
									self.doSave({
										isSaveClose : true
									});

								}
							},
							// 关闭
							afaUserPage_closeBtn : {
								click : function() {
									$.closeDialog();
								}
							},

						},
						loadData : function(param, callback) {
							var url = "platform/appframe/controller/afaapplication/getAfaUser.do"
							$.ajaxCall({
								url : url,
								data : param,
								callback : function(data) {
									$A("#afaUserPage_form").refreshFormData(data);
									if (callback) {
										callback();
									}
								}
							})
						},
						validateUserCode : function(userCode,callback){


                            return false;

                        },
						// 保存数据cofig:{isSaveAdd:"保存并新增",isSaveClose:"保存关闭",isSaveView:"保存查看"}可自行扩展
						doSave : function(config, callback) {
							var url = "user/add.do";
							//var userName = $A("#majorUserCode").suggest("getText");
							//$A("#majorUserName").textbox("setValue", userName);

                            var result;

                            if($A("#userCode").textbox("getValue") != null){
                                $A.ajax.ajaxCall({
                                    url : "user/isExistUserCode.do",
                                    async: false,
                                    method : "get",
                                    type : "json",
                                    data : {
                                        'userCode' : $A("#userCode").textbox("getValue")
                                    },
                                    success : function(data){
                                        result = data;
                                    },
									error: function(){

									}
                                });
                                if(result){
                                    $a.messager.warn("账号已存在,请重新输入账号");
                                    return false;
                                }
                            }

                            if($A("#startDate").datetime("getValue")>$A("#endDate").datetime("getValue")){
								$a.messager.warn("用户有效日期不能大于用户失效日期！");	
								return false;
							}else{
								var userCode=$A('#userCode').textbox('getValue');
								if(!AfaUserDlg.getInstance().validateUserCode(userCode)){
									$A('#afaUserPage_form').sumbitAllComp({
										submitMode : 'all',
										url : url,
										async:false,
										traditional:true,
										type : "post",
										callback : function(data) {
											$a.messager.correct("操作成功！");
											$.closeDialog();
											$('#afaOrgPanel_User_details').grid('reload');
										}
									});
								}else{
									$A('#userCode').textbox('clearValue');
								}
							}
						},
						// 显示弹出窗口，action
						// 窗口状态来源，ACTION:{ADD:"",EDIT:"",VIEW:""}//可自行扩展
						showPage : function(action, data, callback) {
							var url;
							var title;

							url = "user/addUser.do";
							title = "新增用户";

							AfaUserDlg.getInstance().orgMsg=data;
							this.showPageCallBack = callback || function() {
							};
							var self = this;
							this.indexAction = action;
							var options = {
								url : url,
								dialogId : "directPayBookAdd",
								title : title,
								width : 800,
								height : 450,
								wrapper : true,
								hasheader : false,
								reload : true,
								onPageLoad : function(obj) {


								}
							};
							$.openModalDialog(options)
						},

						// 页面加载后初始化
						initPage : function() {
							$.validator.addMethod("identity",function(value, element, param) {
												if (value.match(/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/)|| value == "")
													return true;
												return false;
											});
						},
						// 控件属性重置
						initUIExtConfig : function() {
							this.uiExtConfig = {
							// 格式 #控件id#:function(控件属性集类){
							// config.setAttr("控件属性名","属性值"),//
							// 网格，下拉网格，特殊设置config.getColumn("网列id").setAttr("列属性名","列属性值")config.getButton("网格内包含的按钮id").setAttr("handler","点击事件")
							// }

							}
						}

					});
			// 创建窗体类单例
			AfaUserDlg.getInstance = function() {
				if (!this.instance) {
					this.instance = new AfaUserDlg();
				}
				return this.instance;
			}

			return AfaUserDlg.getInstance();
		})